<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= destination.city %> - Details</title>
    <link rel="stylesheet" href="/stylsheets/show.css" />
  </head>
  <body>
    <main>
      <!-- Destination Title -->
      <h1><%= destination.city %>, <%= destination.country %></h1>

      <!-- City Image (Centered) -->
      <div class="city-image">
        <% if (destination.images.length) { %>
          <img src="<%= destination.images[0] %>" alt="Image of <%= destination.city %>" />
        <% } else { %>
          <p>No image available for this destination.</p>
        <% } %>
      </div>

      <!-- Description Section -->
      <section class="description">
        <h2>Description</h2>
        <p><%= destination.description %></p>
      </section>

      <!-- Points of Interest Cards -->
      <section class="points-of-interest">
        <h2>Points of Interest</h2>
        <div class="poi-cards">
          <% destination.pointsOfInterest.forEach((poi) => { %>
            <div class="poi-card">
              <h3><%= poi.name %> <%= poi.type %></h3>
              <p><%= poi.description %></p>
            </div>
          <% }) %>
        </div>
      </section>

      <!-- Attendees Section -->
      <section class="attendees">
        <h3>Attendees</h3>
        <p><%= destination.attendees.length %> people attending</p>
        <% if (user) { %>
          <form action="/destinations/<%= destination._id %>/attending?_method=<%= destination.attendees.some(a => a.equals(user._id)) ? 'DELETE' : 'POST' %>" method="POST">
            <button><%= destination.attendees.some(a => a.equals(user._id)) ? 'Leave' : 'Join' %> this destination</button>
          </form>
        <% } else { %>
          <p><a href="/auth/log-in">Log in</a> to join this destination.</p>
        <% } %>
      </section>

      <!-- Comment Section -->
      <section class="comments">
        <h2>Comments</h2>
        <% if (comments.length) { %>
          <% comments.forEach(comment => { %>
            <div class="comment">
              <p>
                <strong><%= comment.user.username %>:</strong> <%= comment.text %> 
                <small>(<%= new Date(comment.createdAt).toLocaleDateString() %>)</small>
              </p>
              <% if (user && comment.user._id.equals(user._id)) { %>
                <form action="/destinations/<%= destination._id %>/comments/<%= comment._id %>?_method=DELETE" method="POST">
                  <button type="submit">Delete</button>
                </form>
              <% } %>
            </div>
          <% }) %>
        <% } else { %>
          <p>No comments yet. Be the first to comment!</p>
        <% } %>
        
        <!-- Comment Form -->
        <% if (user) { %>
          <form action="/destinations/<%= destination._id %>/comments" method="POST">
            <textarea name="text" required placeholder="Write a comment..."></textarea>
            <button type="submit">Submit</button>
          </form>
        <% } else { %>
          <p><a href="/auth/log-in">Log in</a> to comment.</p>
        <% } %>
      </section>

      <!-- Back Link -->
      <p><a href="/">Back to Destinations</a></p>
    </main>
  </body>
</html>
